---
layout: post
title: Javascript连续赋值
subtitle: var a = b = 3
date: 2020-03-21
author: dukang
header-img: img/js.jpg
catalog: true
tags: 
    - Javascript
---

## Origin

```javascript
var b = a = 3;
console.log(a,b);  // a = ? , b = ?
```

## 你应该知道的知识

##### 1.赋值运算符 `=`

​	在javascript中，赋值运算符是 `从右到左` （关联性）。

​	*注意：[运算符的优先级](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)

##### 2.[逗号操作符](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comma_Operator)

​	定义：对它的每个操作数求值 `从左到右`，并**返回最后一个操作数的值**。 

​	优先级  1 （最低）

### 解析为原始赋值结构

在遇到此情况时，应该**先将其分解为简单赋值语句**。

```javascript
var b = a = 3;

//分解
a = 3;
var b = a;
console.log(a,b); // 3 3 (在同一作用域下)
```

```javascript
 (function() {
        var m = n = 3;
 })();
console.log(typeof m === "undefined");//true
console.log(typeof n === "undefined");//false

//外部作用域下只有 n 
```

### 示例(1)

```javascript
var a = 1;
var b = 2[a, b] = [b, a];
// 问，a和b的值是多少？ 为什么？
/*------------解析 --------------------*/
// 1.对象增加属性和修改属性的方式
	let obj = {};
	obj.name = 'dk';
	obj['sex'] = 'man';
	obj[1,2] = '2'; // 并不会报错，问题就在这里。
// 2.obj[1,2] = 3; 解析
	let m = (3,2,1); // m 实际值为 1 ，参考第2点
	//所以
    obj[1,2] = 3;  >>>  obj[(1,2)] = 3; >>> obj[2] = 3;
// 3.回到题目
	// 可理解代码为(实际并不是)
    var a = undefined;
	var b = undefined;
	a = 1;
	b = 2[b,a] = [b,a] 【1】
	//运行到【1】时，即是一个连续赋值的问题了。实际赋值顺序是：
	// (a.) 
	2[b,a] = [b,a] // 2[1,undefined] = [undefined,1] 会报错吗？ 【2】
	// (b.) 
	b = 2[b,a] // b 是指向对象2的属性a的值, 而2[a] = [b,a],所有 b = [b,a]
// 4.【2】的理解
	'123456'.length // 6, 这个都能够理解。其实他就是一个包装类。
	'123456'.length === '123456'['length'] === '123456'[1,'length']
	
	'123456'[1,'length'] = [1,2]  
	//重点理解这句话,不会报错的。实际'123456'这个对象并不存在。可以理解为中间件。 
// 5.答案
	a = 1; b = [undefined,1]
```

### 示例(2）

```javascript
var a = { n: 1 } 	
var b = a; 			
a.n = a = { m: 1 }	
// 问，a和b的值是多少？ 为什么？
/*------------解析 1--------------------*/
// 拆分运算顺序 （1）a.n （2）a = {m:1} （3）a.n = a
//	a.n 分配新的地址，则  { n: - }
// a = { m : 1}
// a.n = { m: 1 } ==> {n: { m: 1} }
// b=a ==> b = {n: { m: 1} }

/*------------解析 2--------------------*/
// 1.只要对变量进行赋值就会进行内存重新申请。 【1】
	var a = 1; 
	a = 2;
	var obj = {
        name: 'boom'
    }
    obj.name = 'dik'
	//对象一样的，只是重新获取属性的地址.
// 2.【2】
	// 变量a 内存分配图
    
// 3.【3】
	// 变量b 内存分配图
    
// 4. 在计算机中，复杂数据类型存储的都是地址，我们在取值时，都是根据地址（门牌号）去查找。

// 5. a.n = a = { m: 1 }	
	//执行a.n = a = { m: 1 },a.n和a都要申请新的地址，而且在Js引擎中，确实也是读到这句话就会给这个值进行内存分配。【4】
	//分为三步：
    // (1)
	a.n; // a对象添加了属性n，值为undefined
	// (2)
	a = {m : 1}
	// (3) 
	a.n = a
// 6.答案
	a = {m: 1}
	b = { n: { m: 1 }}
```

【1】解释过程 （内存如何重新申请的）

执行 a = 1时 ，内存示意图。

|   地址   |  变量  | 存储值  |
| :----: | :--: | :--: |
| 0x0001 |  a   |  1   |

执行 a = 2 时，内存变化示意图  (原来的内存被释放？)

|     地址     |  变量   |  存储值  |
| :--------: | :---: | :---: |
| ~~0x0001~~ | ~~a~~ | ~~1~~ |
|   0x0002   |   a   |   2   |

【2】a 的内存示意图

|   地址   |  变量  |  存储值   |
| :----: | :--: | :----: |
| 0x0001 |  a   | 0x0002 |
| 0x0002 | a.n  |   1    |

【3】 b的内存示意图

|   地址   |  变量  |  存储值   |
| :----: | :--: | :----: |
|        |      |        |
|        |      |        |
| 0x0003 |  b   | 0x0001 |

【4】a.n 和 a 重新分配内存

|   地址   |   变量    |        存储值        |
| :----: | :-----: | :---------------: |
| 0x0001 |  ~~a~~  | ~~0x0002~~ 0x0004 |
| 0x0002 | ~~a.n~~ |         1         |
| 0x0003 |    b    |      0x0001       |
| 0x0004 |   a.n   |                   |
| 0x0005 |    a    |                   |

# 总结

1. `只要对变量进行赋值就会进行内存重新申请`
2. 根据运算符优先级运算分析

